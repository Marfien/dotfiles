#!/usr/bin/env sh

if [ "$#" != 1 ]; then
  echo "Usage: kotlinr <file>"
  exit 1
fi

target="$1"

output="$(mktemp -d)/result.jar"

if ! kotlinc "$target" -include-runtime -d "$output"; then
  exit_code=$?
  echo ""
  echo "Failed to compile '$target'"
  exit $exit_code
fi

java -jar "$output"
exit_code=$?
rm -f "$output"

echo ""
echo "Program exited with exit code $exit_code"
exit $exit_code
